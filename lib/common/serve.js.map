{"version":3,"sources":["../../src/common/serve.js"],"names":["args","split","process","argv","slice","length","es6","scss","port","server","createServer","request","response","console","log","url","setHeader","filePath","qPos","indexOf","resolve","extname","String","toLowerCase","contentType","mimeTypes","renderSync","file","css","writeHead","end","toString","readFile","error","content","code","ignore","i","babel","transform","presets","plugins","sourceRoot","pwd","on","e","listen","serve","__dirname"],"mappings":"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","file":"serve.js","sourcesContent":["import http from 'http'\nimport fs from 'fs'\nimport path from 'path'\nimport * as babel from 'babel-core'\nimport sass from 'node-sass'\n\nimport {argsParser} from '../utils/_utils'\nimport {ignores, onlys, presets, plugins} from '../config/babel'\n\nconst pwd = __dirname\n// $ serve [src]\n\nasync function serve(args) {\n    args = (args) ? args.split(' ') : process.argv.slice(3, process.argv.length)\n    args = argsParser(args)\n\n    const es6 = (args.es6) ? args.es6 : false\n    const scss = (args.scss) ? args.scss : false\n    const port = (args.port) ? args.port : 3000\n\n    const server = http.createServer((request, response) => {\n        console.log('request ', request.url)\n\n        //cors\n        response.setHeader('Access-Control-Allow-Origin', '*')\n        response.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE')\n        response.setHeader('Access-Control-Allow-Headers', 'X-Requested-With,content-type')\n        response.setHeader('Access-Control-Allow-Credentials', true)\n\n        let filePath = request.url\n\n        let qPos = filePath.indexOf('?');\n        if (qPos > -1) {\n            filePath = filePath.slice(0, qPos);\n        }\n\n        filePath = filePath === '/' ? `${args[0]}/index.html` : `${args[0]}${filePath}`\n        filePath = path.resolve(filePath)\n\n        let extname = String(path.extname(filePath)).toLowerCase()\n        let contentType = 'text/html'\n        let mimeTypes = {\n            '.html': 'text/html',\n            '.js':   'text/javascript',\n            '.css':  'text/css',\n            '.json': 'application/json',\n            '.png':  'image/png',\n            '.jpg':  'image/jpg',\n            '.gif':  'image/gif',\n            '.wav':  'audio/wav',\n            '.mp4':  'video/mp4',\n            '.woff': 'application/font-woff',\n            '.woff2': 'application/font-woff2',\n            '.ttf':  'applilcation/font-ttf',\n            '.eot':  'application/vnd.ms-fontobject',\n            '.otf':  'application/font-otf',\n            '.svg':  'application/image/svg+xml'\n        }\n\n        contentType = mimeTypes[extname] || 'application/octect-stream'\n\n        if (scss && filePath.indexOf('styles.css') > -1){\n            let {css} = sass.renderSync({\n                file: 'src/scss/styles.scss'\n            })\n            response.writeHead(200, { 'Content-Type': 'text/css' })\n            response.end(css.toString(), 'utf-8')\n            return\n        }\n\n        fs.readFile(filePath, (error, content) => {\n            if (error) {\n                if(error.code == 'ENOENT'){\n                    response.writeHead(404)\n                    response.end('Not found', 'utf-8')\n                    return\n                }\n                response.writeHead(500)\n                response.end('Sorry, check with the site admin for error: '+error.code+' ..\\n')\n                response.end()\n                return\n            }\n\n            if (es6 && contentType === 'text/javascript'){\n                let ignore = false\n                for (var i = 0; i < ignores.length; i++) {\n                    if (filePath.indexOf(ignores[i]) > -1){\n                        ignore = true\n                        break\n                    }\n                }\n\n                for (var i = 0; i < onlys.length; i++) {\n                    if (filePath.indexOf(onlys[i])>-1){\n                        ignore = false\n                        break\n                    }\n                }\n\n\n                if (!ignore){\n                    let {code} = babel.transform(content, {\n                        presets,\n                        plugins,\n                        sourceRoot: pwd\n                    })\n                    content = code\n                }\n            }\n\n            response.writeHead(200, { 'Content-Type': contentType })\n            response.end(content, 'utf-8')\n            return\n        })\n\n    })\n    .on('error', function (e) {\n        // Handle your error here\n        console.log(e)\n    })\n\n    server.listen(port)\n    console.log(`Server is listening on port ${port}`);\n}\n\nexport default serve\n"]}